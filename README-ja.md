# Readoku - あなたの即時日本語翻訳コンパニオン

Readokuは、ブラウジング中に遭遇するあらゆる英語の文章や単語の日本語への翻訳をユーザーが迅速に理解できるよう設計されたブラウザ拡張機能です。

## 現在の状況と機能

*   **デュアル翻訳モード:**
    *   **詳細な単語検索（Shift + ホバー）**: `Shift`キーを押しながら英単語にホバーすると、Gemini APIによる詳細な情報（読み（ひらがな/カタカナ）、ローマ字読み、品詞、英語の定義、日本語での説明、例文（英語と日本語））が記載されたポップアップが表示されます。リッチな表示のためにJSON形式でレスポンスを要求します。
    *   **フレーズ/文章翻訳（ハイライトしてクリック）**: テキスト（英語など）をハイライトすると、選択範囲の末尾に小さなReadokuボタン（R⚡）が表示されます。このボタンをクリックすると、ハイライトされたテキストが日本語に翻訳されてポップアップに表示されます。
*   **Gemini API搭載**: ローカルプロキシサーバー経由でGoogle Gemini APIを利用し、強力でニュアンスのある翻訳を実現します。
*   **ローカル辞書のフォールバック**: 単一単語の検索（Shift + ホバー）でGemini API呼び出しが失敗した場合、拡張機能はローカルの辞書(`scripts/`)で単語を検索し、基本的な定義を表示しようとします。
*   **安全なAPIキー処理**: Gemini APIキーは環境変数を使用して安全に管理され、コードベースには保存されません。
*   **拡張機能の有効/無効切り替え**: ユーザーはブラウザツールバーの拡張機能のポップアップメニューから拡張機能のオン/オフを切り替えることができます。

## セットアップとインストール

Readokuを起動して実行するには、拡張機能とローカルプロキシサーバーの両方をセットアップする必要があります。

### 1. プロキシサーバーのセットアップ

プロキシサーバーはGemini APIとの通信を処理します。

1.  **`proxy-server`ディレクトリに移動します:**
    ```bash
    cd proxy-server
    ```
2.  **Python仮想環境の作成（推奨）:**
    ```bash
    python -m venv .venv  # または python3 -m venv .venv
    source .venv/bin/activate  # Windowsの場合: .venv\Scripts\activate
    ```
3.  **依存関係のインストール:**
    ```bash
    pip install -r requirements.txt  # または pip3 install -r requirements.txt
    ```
4.  **Gemini APIキーの取得:**
    *   [Google AI Studio](https://aistudio.google.com/app/apikey)（またはGoogle Cloud Console）にアクセスします。
    *   **新しいAPIキー**を作成します。
    *   **重要: APIキーを制限**し、「Generative Language API」（または使用している特定のGeminiモデル、例: `gemini-1.5-flash`）へのアクセスのみを許可するようにしてください。
5.  **APIキーを環境変数として設定:**
    ターミナルで、サーバーを実行する前に`GEMINI_API_KEY`環境変数を設定します:
    ```bash
    export GEMINI_API_KEY="あなたの新しい制限付きAPIキー"
    ```
    `\"あなたの新しい制限付きAPIキー\"`を実際に取得したキーに置き換えてください。
    *（永続的なストレージのためには、この行を`~/.zshrc`や`~/.bashrc`のようなシェルの設定ファイルに追加し、そのファイルがGitにコミットされないようにすることを検討してください。）*
6.  **プロキシサーバーの実行:**
    ```bash
    python server.py
    ```
    サーバーは通常`http://localhost:5001`で実行されているはずです。

### 2. ブラウザ拡張機能のインストール

1.  **リポジトリのクローン**:まだクローンしていない場合は、このリポジトリをクローンします。
2.  **ブラウザの拡張機能管理ページを開く:**
    *   **Chrome/Edge**: `chrome://extensions`に移動します。
    *   **Firefox**: `about:debugging#/runtime/this-firefox`に移動します。
3.  **開発者モードを有効にする:**
    *   **Chrome/Edge**: 「デベロッパーモード」をオンに切り替えます（通常は右上）。
    *   **Firefox**: 通常、`about:debugging`ページではデフォルトで有効になっています。
4.  **拡張機能の読み込み:**
    *   **Chrome/Edge**: 「パッケージ化されていない拡張機能を読み込む」をクリックし、このリポジトリから`extension`ディレクトリを選択します。
    *   **Firefox**: 「一時的なアドオンを読み込む...」をクリックし、`extension`ディレクトリ内の`manifest.json`ファイルを選択します。
5.  Readokuアイコンがブラウザのツールバーに表示されるはずです。

## 特定機能のテスト

*   **詳細な単語検索**:
    *   プロキシサーバーが有効なAPIキーで実行されていることを確認します。
    *   英語のテキストがあるウェブページを開きます。
    *   `Shift`キーを押しながら英単語にホバーします。詳細なポップアップが表示されるはずです。
    *   APIが失敗し、単語が`extension/dictionary.json`（例: "Japan"）に存在する場合、よりシンプルなフォールバック翻訳が表示されることがあります。
*   **フレーズ/文章翻訳**:
    *   テキスト（例: 「Hello, how are you?」のような英語の文章）をハイライトします。
    *   選択範囲の近くに小さな「R⚡」ボタンが表示されるはずです。
    *   ボタンをクリックします。ポップアップにハイライトされたテキストの日本語翻訳が表示されるはずです。 